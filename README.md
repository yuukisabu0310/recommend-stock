# 株式市場分析・銘柄選定アプリ

株初心者〜中級者向けの市場環境分析・銘柄選定アプリです。GitHub Actions + Python + GitHub Pages を使用して、定期的に市場分析レポートを自動生成します。

## 機能

### 市場環境分析
- **Market Direction Overview**: 国別（米国・日本）× 期間（短期/中期/長期）ごとの市場方向感を5段階で表示
- **市場スタンス表示**: 🟢強気 / 🟡中立 / 🔴弱気の視覚的表示
- **移動平均によるトレンド判定**: 短期（20日）、中期（75日）、長期（200日）の移動平均を使用
- **国別市場判断**: 各国の短期・中期・長期の市場環境を分析
  - **前提条件**: 現在の判断の前提条件を明示
  - **リスク**: 想定される最大リスクを必ず表示
  - **転換シグナル**: 方向感が変わる可能性のある条件・イベントを必ず表示

### 銘柄選定（参考情報）
- **銘柄評価**: 日本株・米国株の参考銘柄情報を提示（投資助言ではありません）
  - **ファンダメンタル評価**: 売上成長率、営業利益率、ROE、時価総額区分
  - **テクニカル評価**: 移動平均によるトレンド、出来高傾向
  - **条件合致度評価**: ◯ / △ / × による評価
  - **前提条件・リスク・転換シグナル**: 各銘柄ごとに必ず表示
- **詳細パネル**: 銘柄クリックで詳細情報を表示

### 思考ログ（判断材料の提示）
思考ログは「判断結果」ではなく、「判断材料」として提示します。すべての市場分析・銘柄分析は、以下の4ブロック構成で表示されます：

1. **観測事実（Fact）**: 実際に観測できる数値・状態のみを列挙（主観的表現は禁止）
2. **解釈（Interpretation）**: 観測事実から考えられる見方を文章で説明（断定しない表現を使用）
3. **この見方が成り立つ前提（Assumption）**: 解釈が有効であるための条件を明示（再現可能な条件）
4. **見方が変わる条件（転換シグナル）**: 判断が変わる具体的なトリガーを数値で示す（曖昧な表現は禁止）

### その他
- **注目セクター**: マクロ・地政学・政策を元に注目セクターを提示
- **データ取得元・更新頻度・計算方法の明示**: 透明性を確保

## 技術構成

- **Python 3.11+**: データ取得・分析
- **yfinance**: 株価データ取得（Yahoo Finance、無料）
- **Groq API**: 市場方向感の分析・評価（LLM: `llama-3.3-70b-versatile`）
- **GitHub Actions**: 定期実行・自動デプロイ
- **GitHub Pages**: HTML静的表示

**重要なポイント**: 
- **Groq APIキーが必要です**（`GROQ_API_KEY`環境変数）
- LLMは市場方向感の総合判断を担当（データ取得・計算はPython側で実施）
- ルールベース分析も併用（思考ログに表示）

## セットアップ

### 1. リポジトリのクローン

```bash
git clone <repository-url>
cd recommend-stock
```

### 2. 依存パッケージのインストール

```bash
pip install -r requirements.txt
```

### 3. 環境変数の設定

`.env` ファイルを作成して以下を設定：

```bash
GROQ_API_KEY=your_groq_api_key  # 必須（Groq APIキーを取得してください）
FRED_API_KEY=your_fred_api_key  # 必須（FRED APIキーを取得してください）
ESTAT_APP_ID=your_estat_app_id  # 必須（e-Stat APIアプリケーションIDを取得してください）
```

または、GitHub Actions を使用する場合は、リポジトリの Secrets に以下を設定してください：
- `GROQ_API_KEY`
- `FRED_API_KEY`

**APIキーの取得方法**:

1. **Groq APIキー**:
   - [Groq Console](https://console.groq.com/) にアクセス
   - アカウントを作成（無料）
   - API Keys セクションでAPIキーを生成

2. **FRED APIキー**（無料）:
   - [FRED API Key](https://fred.stlouisfed.org/docs/api/api_key.html) にアクセス
   - アカウントを作成（無料）
   - API Keys セクションでAPIキーを生成
   - 米国のCPI、雇用率、政策金利、長期金利の実データ取得に使用

3. **e-Stat APIアプリケーションID**（無料、ユーザー登録が必要）:
   - [e-Stat API](https://www.e-stat.go.jp/api/api-dev/how_to_use) にアクセス
   - ユーザー登録（無料）
   - マイページからアプリケーションIDを発行
   - 日本のCPI、雇用率の実データ取得に使用（公式データ）

### 4. 設定ファイルの確認

`config/config.yml` で以下を設定可能です：

- 対象国・指数
- 投資期間の定義
- おすすめ銘柄件数
- AI設定（ON/OFF、プロンプト等）
- イベント検知条件

## 実行方法

### ローカル実行

```bash
python src/main.py
```

実行結果は `docs/` ディレクトリに HTML ファイルとして出力されます。

### GitHub Actions での自動実行

1. `.github/workflows/market-analysis.yml` が自動実行されます
2. デフォルトでは毎日日本時間 18:00 に実行
3. `workflow_dispatch` で手動実行も可能
4. 結果は GitHub Pages に自動デプロイされます

## 出力ファイル

実行結果は `docs/` ディレクトリに出力され、GitHub Pages で閲覧可能です：

- `docs/index.html`: メインレポート（モダンなデザイン、カード形式、視覚的にわかりやすい）
- `docs/details/{country}-{timeframe}.html`: 国別・期間別詳細ページ
- `docs/logs/{country}-{timeframe}.html`: 思考ログ

内部データ（JSON形式）は `outputs/` ディレクトリに保存されます：
- `outputs/market_data.json`: 取得した市場データ
- `outputs/analysis_result.json`: 分析結果（JSON）
- `outputs/fallback/`: API失敗時用のフォールバックデータ

## 設定について

すべての設定は `config/config.yml` で管理されます：

### 対象国

```yaml
countries:
  - name: "米国"
    code: "US"
    indices: ["SPX", "NDX"]
    universe: ["S&P500", "NASDAQ100"]
```

### 投資期間

```yaml
timeframes:
  - name: "短期"
    code: "short"
    days: 30
    weights:
      technical: 0.5
      macro: 0.3
```

### スコア範囲

- `+2`: ↗↗ 超強気
- `+1`: ↗ やや強気
- `0`: → 中立
- `-1`: ↘ やや弱気
- `-2`: ↘↘ 超弱気

## 免責事項

**本アプリは研究用途であり、投資助言や売買指示を目的としたものではありません。**

### 絶対条件
- 投資判断はユーザーの自己責任
- 過去の実績は将来を保証しない
- 売買を断定する表現は禁止
- 常に「前提・リスク・転換シグナル」を明示
- 結論を出さず、判断材料のみを提示

### 禁止表現
「買い」「売り」「今がチャンス」「必ず上がる」「儲かる」「推奨」「おすすめ」「目標株価」「期待リターン」「利益率」

### 許可表現
「〜の傾向が見られる」「〜という前提が成り立っている」「条件が崩れた場合は注意が必要」「参考情報として〜」

### 目的
このアプリは「判断を促さず、判断力を育てる」ことを目的としています。

## ライセンス

MIT License

## 貢献

プルリクエストや Issue を歓迎します。ただし、投資助言や売買指示を含む内容は禁止です。

